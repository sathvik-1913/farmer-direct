<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Confirmation - Farmer Direct</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
        }
        .success { color: #2d5a27; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="status">Confirming your email...</h1>
        <p id="message">Please wait while we verify your email address.</p>
        <a href="buyer-login.html" id="loginLink" style="display: none; margin-top: 20px; display: inline-block; padding: 10px 20px; background: #2d5a27; color: white; text-decoration: none; border-radius: 5px;">Go to Login</a>
    </div>

    <script>
        const supabaseUrl = 'https://izvhayrqtiiyosrkgelk.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6dmhheXJxdGlpeW9zcmtnZWxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MDk5NDIsImV4cCI6MjA3ODE4NTk0Mn0.wKY5HfvlpALL8ekvr-yyo0EFw7IWWEPPe1XM_39xetc';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function handleEmailConfirmation() {
            const hash = window.location.hash;
            const statusElement = document.getElementById('status');
            const messageElement = document.getElementById('message');
            const loginLink = document.getElementById('loginLink');

            try {
                const { data, error } = await supabase.auth.getSession();
                
                if (error) throw error;
                
                if (data.session) {
                    statusElement.textContent = 'Email Confirmed!';
                    statusElement.className = 'success';
                    messageElement.textContent = 'Your email has been successfully verified. You can now login to your account.';
                    loginLink.style.display = 'inline-block';
                } else {
                    statusElement.textContent = 'Confirmation Required';
                    statusElement.className = 'error';
                    messageElement.textContent = 'Please check your email for the confirmation link and click it to verify your account.';
                }
            } catch (error) {
                statusElement.textContent = 'Confirmation Error';
                statusElement.className = 'error';
                messageElement.textContent = 'There was an error confirming your email. Please try signing up again.';
                console.error('Confirmation error:', error);
            }
        }

        // Handle the email confirmation
        handleEmailConfirmation();
    </script>
</body>
</html>
